<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>触屏编辑模式示例</title>
	<style>
		:root{--accent:#2b6cb0;--muted:#f3f4f6}
		html,body{height:100%}
		body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#111;margin:0;padding:0;background:#fff;-webkit-tap-highlight-color:transparent}
		header{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #eee;background:#fafafa}
		.header-left{flex:1}
		.btn{background:var(--accent);color:#fff;padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
		.btn.secondary{background:#fff;color:var(--accent);border:1px solid var(--accent)}

		.canvas{max-width:520px;margin:12px auto;padding:12px}
		.small{font-size:13px;color:#555}

		/* Two vertical groups */
		.groups{display:flex;flex-direction:column;gap:18px}
		.group{background:var(--muted);padding:12px;border-radius:12px;min-height:100px}
		.group-title{font-weight:600;margin-bottom:8px}
		.group-items{display:flex;flex-wrap:wrap;gap:12px}

		/* limit group2 to max 2 items per row */
		#group2 .group-items{max-width:292px}

		/* Circular elements */
		.item{width:64px;height:64px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.08);position:relative;user-select:none;touch-action:manipulation}
		.item .label{font-size:13px;text-align:center;padding:6px}

		/* second group: rectangular by default (two circles width + gap) */
		#group2 .item{
			width:calc(64px * 2 + 12px);
			height:64px;
			border-radius:12px;
			flex:0 0 calc(64px * 2 + 12px);
		}

		/* when editing, second group items become circular */
		.editing #group2 .item{width:64px;height:64px;border-radius:50%;flex:0 0 64px}

		/* overlay controls (shown only in edit mode) */
		.ctrl{position:absolute;top:-8px;right:-8px;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.12);font-weight:700;color:var(--accent);border:1px solid #ddd}
		.ctrl.hidden{display:none}

		/* edit mode visuals */
		.editing .item{outline:2px dashed rgba(43,108,176,0.14)}

		/* toast */
		.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111;color:#fff;padding:10px 14px;border-radius:8px;opacity:0;pointer-events:none;transition:opacity .18s}
		.toast.show{opacity:0.95;pointer-events:auto}



		@media (min-width:720px){.canvas{max-width:720px}}
	</style>


	<main class="canvas" id="canvas">
		<div style="display:flex;justify-content:flex-start;gap:8px;margin-bottom:10px">
			<button id="resetBtn" class="btn secondary">重置示例</button>
			<button id="doneBtn" class="btn secondary">完成编辑</button>
		</div>
		<div class="groups" id="groups">
			<section class="group" id="group1">
				<div class="group-title">第一组（最多 4 个）</div>
				<div class="group-items" id="group1Items"></div>
			</section>

			<section class="group" id="group2">
				<div class="group-title">第二组（不限数量）</div>
				<div class="group-items" id="group2Items"></div>
			</section>
		</div>

		<!-- done button moved to top-right ✅ -->

		<div id="toast" class="toast" role="status" aria-live="polite"></div>
	</main>

	<script>
		(function(){
			const MAX_FIRST = 4;
			const group1Items = document.getElementById('group1Items');
			const group2Items = document.getElementById('group2Items');
			const groupsEl = document.getElementById('groups');
			const resetBtn = document.getElementById('resetBtn');
			const doneBtn = document.getElementById('doneBtn');
			const toast = document.getElementById('toast');

			let editMode = false;
			let editModeEnterTime = null;
			let longPressTimer = null;
			let longPressTarget = null;

			function makeItem(id, text){
				const el = document.createElement('div');
				el.className = 'item';
				el.dataset.id = id;
				el.innerHTML = `<div class="label">${text}</div>`;
				const ctrl = document.createElement('div');
				ctrl.className = 'ctrl hidden';
				ctrl.innerText = '';
				el.appendChild(ctrl);
				return el;
			}

			function seed(){
				group1Items.innerHTML = '';
				group2Items.innerHTML = '';
				for(let i=1;i<=3;i++) group1Items.appendChild(makeItem('g1-'+i, 'A'+i));
				for(let i=1;i<=6;i++) group2Items.appendChild(makeItem('g2-'+i, 'B'+i));
				updateControls();
			}

			function updateControls(){
				document.querySelectorAll('.item').forEach(it=>{
					const ctrl = it.querySelector('.ctrl');
					if(!editMode){ ctrl.classList.add('hidden'); ctrl.innerText=''; }
					else{ ctrl.classList.remove('hidden'); if(it.parentElement === group1Items) ctrl.innerText = '−'; else ctrl.innerText = '+'; }
				});
				groupsEl.classList.toggle('editing', editMode);
			}

			function showToast(msg){
				toast.textContent = msg;
				toast.classList.add('show');
				clearTimeout(toast._t);
				toast._t = setTimeout(()=>toast.classList.remove('show'), 2000);
			}

			function startLongPress(e){
				const target = e.target.closest('.item');
				if(!target) return;
				longPressTarget = target;
				longPressTimer = setTimeout(()=>{ enterEditMode(target); }, 600);
			}
			function cancelLongPress(){ clearTimeout(longPressTimer); longPressTimer = null; longPressTarget = null; }

			function enterEditMode(target){ editMode = true; editModeEnterTime = Date.now(); updateControls(); }

			groupsEl.addEventListener('click', (e)=>{
				const ctrl = e.target.closest('.ctrl');
				if(!ctrl) return;
				e.stopPropagation();
				const item = ctrl.parentElement;
				if(ctrl.innerText === '−'){
					group2Items.appendChild(item);
					updateControls();
				} else if(ctrl.innerText === '+'){
					if(group1Items.children.length >= MAX_FIRST){ showToast('第一个组已满，无法添加'); return; }
					group1Items.appendChild(item);
					updateControls();
				}
			});

			groupsEl.addEventListener('touchstart', (e)=>{ startLongPress(e); }, {passive:false});
			groupsEl.addEventListener('touchend', ()=>{ cancelLongPress(); });
			groupsEl.addEventListener('touchcancel', ()=>{ cancelLongPress(); });
			groupsEl.addEventListener('mousedown', (e)=>{ if(e.button===0) startLongPress(e); });
			groupsEl.addEventListener('mouseup', cancelLongPress);
			groupsEl.addEventListener('mouseleave', cancelLongPress);

			// Auto-exit via click on blank space DISABLED - use doneBtn instead
			// document.addEventListener('click', (e)=>{ ... });

			document.addEventListener('touchend', (e)=>{
				// touch-end auto-exit DISABLED - use doneBtn instead
			});

			doneBtn.addEventListener('click', ()=>{ editMode = false; editModeEnterTime = null; updateControls(); showToast('已退出编辑'); });
			resetBtn.addEventListener('click', ()=>{ seed(); showToast('示例已重置'); });

			groupsEl.addEventListener('contextmenu', (e)=>{ e.preventDefault(); });

			seed();
		})();
	</script>
</body>
</html>
